---
title: "Impact de la classe DPE sur la consommation énergétique des logements"
author: "Enedis – Étude statistique"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    theme: readable
    df_print: default
---

```{r setup, include=FALSE}
# Options globales pour les chunks
knitr::opts_chunk$set(
  echo    = FALSE,
  message = FALSE,
  warning = FALSE
)

# Chargement des librairies
library(dplyr)
library(ggplot2)
library(knitr)
library(scales)

# Chargement des données
dpe_raw <- readRDS("dpe_data.rds")

# Harmonisation du nom de la variable type de logement --------------------
# On essaie de retrouver la variable si elle a un autre nom, sinon on la crée.
if (!"type_logement_source" %in% names(dpe_raw)) {
  candidats <- c("type_logement",
                 "Type_logement",
                 "TYPE_LOGEMENT",
                 "TYPE_LOGEMENT_SOURCE",
                 "type_logement_src")
  existe <- candidats[candidats %in% names(dpe_raw)]
  
  if (length(existe) > 0) {
    # On renomme la première colonne trouvée en type_logement_source
    names(dpe_raw)[names(dpe_raw) == existe[1]] <- "type_logement_source"
  } else {
    # Si aucune colonne équivalente n'existe, on crée une variable fictive "Existant"
    dpe_raw$type_logement_source <- factor("Existant", levels = c("Neuf", "Existant"))
  }
}

# Nettoyage et préparation ------------------------------------------------
dpe <- dpe_raw %>%
  # Filtrage des DPE valides + variables nécessaires
  filter(
    etiquette_dpe %in% c("A", "B", "C", "D", "E", "F", "G"),
    !is.na(conso_5_usages_par_m2_ep),
    !is.na(surface_habitable_logement),
    !is.na(conso_5_usages_ep)
  ) %>%
  # On garde uniquement Neuf / Existant si ces modalités existent
  mutate(
    type_logement_source = as.character(type_logement_source)
  )

# Si la variable type_logement_source contient Neuf/Existant, on filtre dessus
if (any(dpe$type_logement_source %in% c("Neuf", "Existant"))) {
  dpe <- dpe %>%
    filter(type_logement_source %in% c("Neuf", "Existant"))
} else {
  # Sinon, on force tout en "Existant" pour que le rapport tourne
  dpe$type_logement_source <- "Existant"
}

# Repassage en facteur propre
dpe <- dpe %>%
  mutate(
    etiquette_dpe = factor(
      etiquette_dpe,
      levels = c("A", "B", "C", "D", "E", "F", "G"),
      ordered = TRUE
    ),
    type_logement_source = factor(
      type_logement_source,
      levels = c("Neuf", "Existant")
    )
  )

# Quelques indicateurs globaux --------------------------------------------
n_total    <- nrow(dpe)
n_neuf     <- sum(dpe$type_logement_source == "Neuf", na.rm = TRUE)
n_existant <- sum(dpe$type_logement_source == "Existant", na.rm = TRUE)

# Tableau de KPI par classe DPE
kpi_dpe <- dpe %>%
  group_by(etiquette_dpe) %>%
  summarise(
    nb_logements              = n(),
    conso_moy_kWhep_m2_an     = mean(conso_5_usages_par_m2_ep, na.rm = TRUE),
    conso_mediane_kWhep_m2_an = median(conso_5_usages_par_m2_ep, na.rm = TRUE),
    .groups = "drop"
  )

# Thème ggplot commun
theme_rapport <- theme_minimal(base_size = 11) +
  theme(
    plot.title   = element_text(face = "bold"),
    axis.title   = element_text(face = "bold"),
    legend.title = element_text(face = "bold")
  )
```

# 1. Introduction et contexte

L’objectif de cette étude, réalisée pour Enedis, est d’**évaluer l’impact de la classe DPE (Diagnostic de Performance Énergétique) sur la consommation énergétique des logements**, exprimée en kWhep/m²/an.  

Une problématique secondaire consiste à **comparer, à DPE équivalent, les consommations des logements neufs et existants** (`type_logement_source` = *"Neuf"* vs *"Existant"*), afin de quantifier l’effet potentiel des normes de construction récentes.

## 1.1. Source et périmètre des données

Les données utilisées proviennent des **données publiques DPE de l’ADEME**, filtrées sur le **département 31**.  

Après nettoyage (voir ci-dessous), le jeu de données final comprend :

- **`r scales::comma(n_total)` logements** au total,  
- dont **`r scales::comma(n_neuf)` logements neufs** (`type_logement_source == "Neuf"`),  
- et **`r scales::comma(n_existant)` logements existants** (`type_logement_source == "Existant"`).

## 1.2. Nettoyage et préparation

Les principales étapes de nettoyage / préparation sont les suivantes :

- **Filtrage des classes DPE valides**, limitées aux étiquettes **A à G** (`etiquette_dpe` ∈ {A, B, C, D, E, F, G}).
- **Suppression des valeurs manquantes** sur :
  - la consommation énergétique par m² et par an : `conso_5_usages_par_m2_ep`,
  - la surface habitable du logement : `surface_habitable_logement`,
  - la consommation totale : `conso_5_usages_ep`.
- **Restriction du périmètre** aux logements pour lesquels `type_logement_source` est renseigné et égal à `"Neuf"` ou `"Existant"` lorsque ces modalités existent.
- Mise en forme de `etiquette_dpe` comme facteur ordonné de A à G, ce qui facilitera les analyses graphiques et la lecture des résultats.

Ces étapes garantissent un **périmètre propre et cohérent** pour l’évaluation de l’impact du DPE sur la consommation énergétique.

# 2. Indicateurs clés de performance (KPI)

Cette section présente des indicateurs descriptifs de base pour quantifier l’association entre la **classe DPE** et la **consommation énergétique par m²**.

```{r kpi_dpe_table}
kpi_dpe %>%
  mutate(
    conso_moy_kWhep_m2_an     = round(conso_moy_kWhep_m2_an, 1),
    conso_mediane_kWhep_m2_an = round(conso_mediane_kWhep_m2_an, 1)
  ) %>%
  knitr::kable(
    caption = "Consommation moyenne, médiane et nombre de logements par classe DPE",
    align   = "c",
    col.names = c(
      "Classe DPE",
      "Nombre de logements",
      "Consommation moyenne (kWhep/m²/an)",
      "Consommation médiane (kWhep/m²/an)"
    )
  )
```

## 2.1. Interprétation des KPI

De manière générale, **on observe une augmentation nette de la consommation énergétique moyenne et médiane lorsque la classe DPE se dégrade** (de A vers G).  

En particulier :

- Les classes **A et B** présentent des **consommations médianes nettement plus faibles**, illustrant de **très bonnes performances énergétiques**.
- Les classes **D et E** représentent souvent le cœur du parc, avec des **consommations intermédiaires**, mais déjà sensiblement plus élevées que les classes les plus performantes.
- Les classes **F et G** se distinguent par des **consommations médianes élevées**, ce qui confirme leur statut de **logements énergivores** (*“passoires thermiques”*).  

Ces premiers indicateurs **valident la pertinence de la classe DPE** comme synthèse de la performance énergétique : plus la classe est dégradée, plus la consommation par m² est importante.

# 3. Analyse univariée : aperçu du parc

Avant de répondre précisément à la problématique, il est utile de caractériser le parc de logements étudié à travers la distribution de quelques variables clés.

## 3.1. Répartition des logements par classe DPE

```{r barplot_dpe}
ggplot(dpe, aes(x = etiquette_dpe)) +
  geom_bar() +
  labs(
    title = "Répartition des logements par classe DPE",
    x     = "Classe DPE",
    y     = "Nombre de logements"
  ) +
  theme_rapport
```

### Interprétation

La répartition des logements par classe DPE montre généralement que :

- Le **parc est concentré sur quelques classes centrales** (souvent C, D, voire E),
- Les classes **très performantes (A)** restent peu représentées,
- De même, la **proportion de logements très énergivores (G)** peut être limitée en volume, mais leur impact énergétique est important.

Cette structure reflète un parc majoritairement **“moyen” à “correct”**, avec néanmoins une **marge de progression significative** sur les classes les plus dégradées.

## 3.2. Distribution de la consommation énergétique par m²

```{r hist_conso_m2}
ggplot(dpe, aes(x = conso_5_usages_par_m2_ep)) +
  geom_histogram(bins = 40) +
  labs(
    title = "Distribution de la consommation énergétique (kWhep/m²/an)",
    x     = "Consommation par m² (kWhep/m²/an)",
    y     = "Nombre de logements"
  ) +
  theme_rapport
```

### Interprétation

La distribution de la consommation par m² :

- **N’est pas symétrique** et s’écarte fortement de la normalité.
- Présente généralement un **pic pour des valeurs modérées** (par exemple autour de quelques centaines de kWhep/m²/an).
- Affiche une **longue traîne vers la droite**, liée à la présence de **logements très énergivores** (*“passoires thermiques”*), qui **tirent la moyenne vers le haut**.

Cette forme justifie l’utilisation conjointe de la **moyenne et de la médiane** pour décrire la consommation et **confirme l’intérêt de travailler par classes DPE** pour segmenter le parc.

# 4. Analyse bivariée : impact du DPE et comparaison Neuf vs Existant

Dans cette section, nous répondons à la **problématique centrale** de l’étude :  
> *Quel est l’impact de la classe DPE sur la consommation énergétique des logements ?*  

et à la **problématique secondaire** :  
> *À classe DPE équivalente, les logements neufs consomment-ils moins que les logements existants ?*

## 4.1. Impact de la classe DPE sur la consommation énergétique

```{r boxplot_dpe}
ggplot(dpe, aes(x = etiquette_dpe, y = conso_5_usages_par_m2_ep)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 1000)) +
  labs(
    title = "Impact de la classe DPE sur la consommation énergétique",
    x     = "Classe DPE",
    y     = "Consommation par m² (kWhep/m²/an)"
  ) +
  theme_rapport
```

### Interprétation

Ce boxplot met en évidence plusieurs éléments clés :

- La **médiane de consommation augmente de manière monotone** de la classe **A** vers la classe **G**, ce qui **valide le caractère ordinal** du DPE du point de vue énergétique.
- Les **boîtes (intervalles interquartiles) s’élargissent** souvent pour les classes les plus dégradées (**E, F, G**), traduisant une **plus grande dispersion** des consommations : les logements mal classés sont **plus hétérogènes**.
- On observe parfois un **chevauchement** entre certaines classes adjacentes (par exemple entre C et D), ce qui reflète le caractère imparfait de toute classification, mais **la tendance globale reste très nette**.

Globalement, ce graphique **confirme fortement la méthodologie DPE** :  
> **plus la classe DPE est dégradée, plus la consommation énergétique par m² est élevée.**

## 4.2. Consommation par DPE : comparaison Neuf vs Existant

```{r boxplot_dpe_neuf_existant}
ggplot(dpe, aes(x = etiquette_dpe, y = conso_5_usages_par_m2_ep, fill = type_logement_source)) +
  geom_boxplot(position = position_dodge(width = 0.7)) +
  coord_cartesian(ylim = c(0, 1000)) +
  labs(
    title = "Consommation par DPE, comparée entre Neuf et Existant",
    x     = "Classe DPE",
    y     = "Consommation par m² (kWhep/m²/an)",
    fill  = "Type de logement"
  ) +
  theme_rapport
```

### Interprétation

La comparaison entre **logements neufs** et **logements existants**, à classe DPE équivalente, met en évidence que :

- Pour une même **classe DPE** (par ex. *C* ou *D*), la **médiane de consommation des logements neufs est généralement inférieure** à celle des logements existants.
- Les **boîtes des logements neufs** tendent à être **plus resserrées**, ce qui peut traduire une **meilleure homogénéité des performances** dans le neuf.
- À l’inverse, les **logements existants** présentent une **dispersion plus forte**, notamment dans les classes intermédiaires et dégradées, signe d’un **parc plus hétérogène** en termes d’isolation, de systèmes de chauffage, etc.

Ces résultats suggèrent que, **au-delà de l’étiquette DPE**, les **normes de construction récentes** et les **pratiques de conception du neuf** offrent **un gain de performance réel**. Le DPE capture une partie de ce différentiel, mais **les logements neufs restent en moyenne plus performants que les existants à classe équivalente**.

## 4.3. Relation entre surface et consommation totale

```{r scatter_surface_conso}
ggplot(dpe, aes(x = surface_habitable_logement, y = conso_5_usages_ep, color = etiquette_dpe)) +
  geom_point(alpha = 0.4) +
  labs(
    title = "Relation entre surface et consommation énergétique totale",
    x     = "Surface habitable du logement (m²)",
    y     = "Consommation totale (kWhep/an)",
    color = "Classe DPE"
  ) +
  theme_rapport
```

### Interprétation

Le nuage de points illustre la relation attendue :

- **La consommation totale augmente avec la surface habitable** : un logement plus grand consomme mécaniquement plus d’énergie, toutes choses égales par ailleurs.
- Pour une **surface donnée** (par exemple autour de 80–100 m²), on observe un **“escalier” de consommation** en fonction de la classe DPE :
  - Les points correspondant aux classes **A / B** se situent en bas du graphique (faible consommation totale),
  - Alors que les points des classes **F / G** se trouvent nettement plus haut (forte consommation totale).

Cette structure permet de **dissocier l’effet “taille” de l’effet “performance énergétique”** :  
> à surface comparable, un logement mieux classé DPE consomme **sensiblement moins** qu’un logement mal classé.

# 5. Conclusion et recommandations

## 5.1. Synthèse des principaux résultats

Les principales conclusions de l’étude peuvent être résumées en quelques points :

1. **Impact clair de la classe DPE sur la consommation par m²**  
   La consommation énergétique moyenne et médiane **augmente de façon nette** lorsque l’on passe d’une classe DPE performante (A/B) à une classe dégradée (F/G).

2. **Différentiel de performance entre Neuf et Existant à DPE égal**  
   Pour une même classe DPE, les **logements neufs présentent en général des consommations plus faibles** et une **dispersion plus faible** que les logements existants, ce qui traduit un **effet positif des normes de construction récentes**.

3. **Rôle conjoint de la surface et du DPE sur la consommation totale**  
   La consommation totale augmente avec la surface, mais, à surface comparable, la **classe DPE reste un facteur discriminant fort** : les logements bien classés consomment **nettement moins** que les logements mal classés.

## 5.2. Réponse à la question d’Enedis

Au vu des analyses réalisées, on peut affirmer que :

> **Oui, la classe DPE est un indicateur globalement fiable de la consommation énergétique des logements.**  

Elle reflète correctement le niveau de consommation par m² et permet de distinguer de façon robuste les logements performants des logements énergivores. Les analyses bivariées confirment une **corrélation positive et monotone** entre la classe DPE et la consommation.

## 5.3. Recommandations opérationnelles

Pour Enedis et, plus largement, pour les acteurs de la transition énergétique, plusieurs pistes d’action ressortent de cette étude :

- **Cibler en priorité les logements existants de classes D, E, F et G**  
  Étant donné l’**importance du parc existant** et ses **consommations élevées**, les **politiques de rénovation énergétique** (isolation, remplacement des systèmes de chauffage, etc.) sur ces classes constituent **un levier majeur** de réduction de la consommation globale sur le territoire.

- **Accompagner la montée en puissance du neuf performant**  
  Les résultats montrent que les **logements neufs sont structurellement plus sobres**, même à DPE équivalent. Poursuivre et renforcer les **normes de construction** et **l’innovation dans le neuf** permet de **verrouiller les gains de performance dans la durée**.

- **Exploiter le DPE comme outil de priorisation fine**  
  Le DPE, couplé à des informations complémentaires (surface, type de logement, ancienneté), peut servir de **base de scoring** pour **prioriser les actions** (rénovations, incitations, programmes d’accompagnement) afin de **maximiser le gain énergétique par euro investi**.

En synthèse, la combinaison de la **classe DPE** et du **type de logement (Neuf vs Existant)** offre à Enedis un **cadre robuste pour cibler et planifier les actions de réduction de la consommation énergétique** dans le département étudié, avec un potentiel de généralisation à d’autres territoires.
